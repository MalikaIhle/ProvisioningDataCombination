#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#	 Malika IHLE & Joel PICK  malika_ihle@hotmail.fr & joel.l.pick@gmail.com
#	 Handling output of simulations running on iceberg 
#	 Start : 22/03/2017
#	 last modif : 22/03/2017
#	 commit: call all files generated by simulation running on iceberg
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

rm(list = ls(all = TRUE))

# import files
fileNames <- list.files("Iceberg/Sim1_out") # vector of filenames
fileList <- lapply(paste("Iceberg/Sim1_out",fileNames, sep="/"), read.csv) # list with one file per element named from 1 to 3114
for (i in 1:length(fileList)) {names(fileList)[[i]]<-fileNames[i]} # change name of each element to be their filename

# select files per Sim type
fileList_Sim1_1 <- fileList[grepl("sim1_1",names(fileList))] 
fileList_Sim1_2 <- fileList[grepl("sim1_2",names(fileList))] 
fileList_Sim1_3 <- fileList[grepl("sim1_3",names(fileList))] 
fileList_Sim1_4 <- fileList[grepl("sim1_4",names(fileList))] 
fileList_Sim1_5 <- fileList[grepl("sim1_5",names(fileList))] 
fileList_Sim1_6 <- fileList[grepl("sim1_6",names(fileList))] 

# Number of files per sim type
NreplicatesSimulation <- c(
length(fileList_Sim1_1), # 1000
length(fileList_Sim1_2), # 1000
length(fileList_Sim1_3), # 1000
length(fileList_Sim1_4), # 1000
length(fileList_Sim1_5), # 1000
length(fileList_Sim1_6)) # 1000

# Function counting number of significant result as a percentage of NreplicatesSimulation
Shape_results <- function(MY_Results, TypeNumber){

sorted_results <- lapply(MY_Results, function(x){ 
subx <- x[,-1] 
subx <- subx[ , order(names(subx))] 
cbind(Factor=x[,1], subx)
})

Signi_results <- lapply(sorted_results, function(x){
x_p <- x[,-(1:((ncol(x)+1)/2))]
x_e <- x[,c(-1,-(((ncol(x)-1)/2+2):ncol(x)))]

cbind(x_p < 0.05, x_e)
})

results_Sign_compiled <- Reduce('+',Signi_results)/NreplicatesSimulation[TypeNumber]
results_Sign_compiled <- cbind(results_Sign_compiled[,c(-(((ncol(results_Sign_compiled))/2+1):ncol(results_Sign_compiled)))]*100,
										results_Sign_compiled[,-(1:((ncol(results_Sign_compiled))/2))])
results_PercentageFactorSignificant <- data.frame(Factor=MY_Results[[1]]$Factor,results_Sign_compiled)

return(results_PercentageFactorSignificant)

}

# shape results Sim 1
Results_Sim_1 <- c(
list(Shape_results(fileList_Sim1_1,1)), # no_autocor_no_cor
list(Shape_results(fileList_Sim1_2,2)), # no_autocor_corCN
list(Shape_results(fileList_Sim1_3,3)), # full_autocor_no_cor
list(Shape_results(fileList_Sim1_4,4)), # full_autocor_corCN
list(Shape_results(fileList_Sim1_5,5)), # partial_autocor_no_cor
list(Shape_results(fileList_Sim1_6,6))) # partial_autocor_corCN

Results_Sim_1

# [[1]]
                    # Factor p_modA p_modA_Ben p_modA_simple p_modAbin p_modAdev p_modS p_modSdev        e_modA e_modA_simple     e_modABen     e_modAbin     e_modAdev        e_modS     e_modSdev
# 1              (Intercept)  100.0      100.0           100     100.0      13.2  100.0      27.5  2.605015e+00  2.6133147943  4.496343e-01  6.302452e-01  0.0408898917  1.922338e+00  0.0646022864
# 2                scale(CN)    0.4        5.1             3       0.4       5.3    0.8       5.1  1.430665e-04  0.0001013989  5.292339e-05 -9.634852e-06 -0.0004980966  2.151344e-04 -0.0009405217
# 3             scale(DiffP)  100.0      100.0           100     100.0      13.3  100.0       7.2 -1.967531e-01 -0.1905999197 -6.549274e-02  5.077855e-01 -0.0492998001 -2.084580e-01 -0.0127810511
# 4            scale(TotalP)  100.0         NA           100     100.0      13.9  100.0      11.3  4.381228e-01  0.4226105150            NA -1.950718e-01  0.0269225887  6.457839e-01 -0.0034723566
# 5               Typez_Obsv    0.0         NA            NA       0.9        NA    0.5        NA  2.792429e-03            NA            NA  6.416772e-03            NA  1.039093e-02            NA
# 6     Typez_Obsv:scale(CN)    0.0         NA            NA       0.3        NA    0.0        NA -3.582409e-05            NA            NA -9.152264e-05            NA -1.284576e-04            NA
# 7  Typez_Obsv:scale(DiffP)    0.0         NA            NA       1.1        NA    0.0        NA -2.298919e-03            NA            NA -7.120173e-03            NA  9.284337e-05            NA
# 8 Typez_Obsv:scale(TotalP)    0.0         NA            NA       0.2        NA    0.0        NA  2.851302e-04            NA            NA  2.866515e-04            NA -4.085765e-03            NA

# [[2]]
                    # Factor p_modA p_modA_Ben p_modA_simple p_modAbin p_modAdev p_modS p_modSdev        e_modA e_modA_simple   e_modABen     e_modAbin    e_modAdev        e_modS     e_modSdev
# 1              (Intercept)    100        100           100     100.0      16.2  100.0      28.3  2.627520e+00    2.63944454  0.46565733  0.5278372862  0.046000602  1.9326875093  0.0650866426
# 2                scale(CN)    100        100           100       0.6       5.7  100.0       4.0  3.985538e-02    0.04384239  0.01523284 -0.0015585664  0.002231233  0.0672160408 -0.0004602265
# 3             scale(DiffP)    100        100           100     100.0      14.0  100.0       8.7 -1.345189e-01   -0.12718962 -0.05480421  0.3981808471 -0.045094974 -0.1391098374 -0.0106960012
# 4            scale(TotalP)    100         NA           100     100.0      12.8  100.0      13.0  4.311243e-01    0.40477642          NA -0.1756687841  0.022066548  0.6402257659 -0.0031922410
# 5               Typez_Obsv      0         NA            NA       1.4        NA    0.6        NA  3.236483e-03            NA          NA  0.0078404470           NA  0.0103693659            NA
# 6     Typez_Obsv:scale(CN)      0         NA            NA       0.3        NA    0.0        NA -5.699069e-05            NA          NA -0.0000602957           NA -0.0014188561            NA
# 7  Typez_Obsv:scale(DiffP)      0         NA            NA       0.9        NA    0.0        NA -1.956256e-03            NA          NA -0.0052844485           NA -0.0001815526            NA
# 8 Typez_Obsv:scale(TotalP)      0         NA            NA       0.3        NA    0.0        NA  2.533370e-05            NA          NA -0.0005823267           NA -0.0029921980            NA

# [[3]]
                    # Factor p_modA p_modA_Ben p_modA_simple p_modAbin p_modAdev p_modS p_modSdev        e_modA e_modA_simple     e_modABen     e_modAbin    e_modAdev        e_modS    e_modSdev
# 1              (Intercept)  100.0      100.0         100.0     100.0     100.0  100.0       100  2.600678e+00  2.825544e+00  5.612566e-01  0.6404542475  4.037164862  1.9108462506  3.200574007
# 2                scale(CN)    0.4        4.7           4.9       0.3       5.4    0.3         5  1.131960e-04  4.092387e-05 -1.384942e-05 -0.0001728787 -0.001764679  0.0001524720 -0.001755834
# 3             scale(DiffP)  100.0      100.0         100.0     100.0     100.0  100.0       100 -2.034118e-01 -2.709447e-01 -9.673077e-02  0.5191174336 -2.767178259 -0.2170606756 -1.597707831
# 4            scale(TotalP)  100.0         NA         100.0     100.0     100.0  100.0       100  4.501590e-01  5.004392e-01            NA -0.2008821488  3.884168946  0.6693550784  3.117358180
# 5               Typez_Obsv  100.0         NA            NA     100.0        NA  100.0        NA  2.196268e-01            NA            NA  0.8208641965           NA  0.3156026889           NA
# 6     Typez_Obsv:scale(CN)    0.0         NA            NA       6.4        NA    0.0        NA -7.052393e-05            NA            NA -0.0003543760           NA -0.0001591036           NA
# 7  Typez_Obsv:scale(DiffP)  100.0         NA            NA      13.5        NA  100.0        NA -7.654797e-02            NA            NA -0.0117303753           NA -0.0458805086           NA
# 8 Typez_Obsv:scale(TotalP)  100.0         NA            NA     100.0        NA   97.9        NA  6.602718e-02            NA            NA  0.2371773001           NA  0.0322180470           NA

# [[4]]
                    # Factor p_modA p_modA_Ben p_modA_simple p_modAbin p_modAdev p_modS p_modSdev       e_modA e_modA_simple   e_modABen    e_modAbin   e_modAdev       e_modS  e_modSdev
# 1              (Intercept)  100.0        100           100     100.0     100.0  100.0     100.0  2.621474572    2.86136246  0.58634878  0.535525001  4.55893742  1.917987898  3.5471258
# 2                scale(CN)   99.8        100           100       0.6      11.9  100.0      21.9  0.038020024    0.04636804  0.05084409 -0.002000824 -0.06988494  0.065873868 -0.1006904
# 3             scale(DiffP)  100.0        100           100     100.0     100.0  100.0     100.0 -0.141187863   -0.19725160 -0.08750133  0.409712735 -2.47925653 -0.145885129 -1.3712951
# 4            scale(TotalP)  100.0         NA           100     100.0     100.0  100.0     100.0  0.447806427    0.49430476          NA -0.178936739  4.63078097  0.667658940  3.7670276
# 5               Typez_Obsv  100.0         NA            NA     100.0        NA  100.0        NA  0.234934133            NA          NA  0.828870742          NA  0.325652554         NA
# 6     Typez_Obsv:scale(CN)    0.7         NA            NA      18.3        NA    0.1        NA  0.006869338            NA          NA  0.020246455          NA  0.004121719         NA
# 7  Typez_Obsv:scale(DiffP)  100.0         NA            NA      23.0        NA  100.0        NA -0.062169084            NA          NA  0.020153537          NA -0.035797310         NA
# 8 Typez_Obsv:scale(TotalP)  100.0         NA            NA     100.0        NA   76.8        NA  0.062856319            NA          NA  0.225927656          NA  0.028804936         NA

# [[5]]
                    # Factor p_modA p_modA_Ben p_modA_simple p_modAbin p_modAdev p_modS p_modSdev      e_modA e_modA_simple   e_modABen   e_modAbin e_modAdev      e_modS e_modSdev
# 1              (Intercept)  100.0        100           100     100.0       100  100.0       100  2.56787510     2.7408948  0.51643406  0.52015136  3.074508  1.88031861  2.621109
# 2                scale(CN)   26.4        100           100      54.6       100   31.7       100  0.01095056     0.0790096  0.03981748  0.02455102  1.210776  0.01650243  1.004313
# 3             scale(DiffP)  100.0        100           100     100.0       100  100.0       100 -0.22160278    -0.2728626 -0.08491868  0.40702686 -2.214889 -0.23374419 -1.444707
# 4            scale(TotalP)  100.0         NA           100     100.0       100  100.0       100  0.47225494     0.5187197          NA -0.11352907  3.351391  0.68920142  2.795863
# 5               Typez_Obsv  100.0         NA            NA     100.0        NA  100.0        NA  0.16633231            NA          NA  0.55900711        NA  0.25757248        NA
# 6     Typez_Obsv:scale(CN)  100.0         NA            NA     100.0        NA  100.0        NA  0.06818554            NA          NA  0.28694066        NA  0.09199843        NA
# 7  Typez_Obsv:scale(DiffP)  100.0         NA            NA      73.4        NA  100.0        NA -0.06270361            NA          NA -0.05532828        NA -0.04481258        NA
# 8 Typez_Obsv:scale(TotalP)  100.0         NA            NA     100.0        NA  100.0        NA  0.06603711            NA          NA  0.25328536        NA  0.03901251        NA

# [[6]]
                    # Factor p_modA p_modA_Ben p_modA_simple p_modAbin p_modAdev p_modS p_modSdev      e_modA e_modA_simple   e_modABen    e_modAbin  e_modAdev      e_modS  e_modSdev
# 1              (Intercept)    100        100           100     100.0       100  100.0       100  2.58889821     2.7877694  0.54529648  0.434695163  4.0387870  1.88326345  3.4102286
# 2                scale(CN)    100        100           100      68.2       100  100.0       100  0.05381288     0.1131409  0.09260915  0.035027275  0.7768755  0.09105722  0.5529963
# 3             scale(DiffP)    100        100           100     100.0       100  100.0       100 -0.15253209    -0.2020827 -0.08213199  0.340784605 -2.3774879 -0.15687976 -1.5137344
# 4            scale(TotalP)    100         NA           100     100.0       100  100.0       100  0.46501050     0.5046187          NA -0.119098037  4.6185223  0.68396436  3.9169931
# 5               Typez_Obsv    100         NA            NA     100.0        NA  100.0        NA  0.19220621            NA          NA  0.634409085         NA  0.28614456         NA
# 6     Typez_Obsv:scale(CN)    100         NA            NA     100.0        NA  100.0        NA  0.05823749            NA          NA  0.232422940         NA  0.06897289         NA
# 7  Typez_Obsv:scale(DiffP)    100         NA            NA       7.6        NA  100.0        NA -0.05766346            NA          NA  0.001851072         NA -0.03973819         NA
# 8 Typez_Obsv:scale(TotalP)    100         NA            NA     100.0        NA   51.9        NA  0.05974807            NA          NA  0.277659918         NA  0.02489425         NA


